adjust_pkgs <- function(pkgs_to_install = "rstudio/shiny,rstudio/bslib", r_version = "4.2.1") {
  is_windows <- .Platform$OS.type == "windows"
  is_linux <- Sys.info()[["sysname"]] == "Linux"
  is_mac <- Sys.info()[["sysname"]] == "Darwin"
  # Get R version like `"4.2"`
  short_r_version <- sub("\\.\\d$", "", r_version)

  replace_or_add <- function(find_val, replace_val) {
    pkgs_to_install <<-
      if (grepl(find_val, pkgs_to_install, fixed = TRUE)) {
        sub(find_val, replace_val, pkgs_to_install, fixed = TRUE)
      } else {
        paste0(pkgs_to_install, ",", replace_val)
      }
  }

  if (is_windows) {
    # terra can't be built from source on Windows + R<4.1
    switch(short_r_version,
      "4.0" = {
        replace_or_add("any::terra", "url::https://cloud.r-project.org/bin/windows/contrib/4.0/terra_1.5-21.zip")
      },
      "3.6" = {
        replace_or_add("any::terra", "url::https://cloud.r-project.org/bin/windows/contrib/3.6/terra_1.2-5.zip")
      }
    )
  } else {
    # Current dev version of terra has a fix that makes it installable on R<4.1
    if (as.package_version(r_version) < as.package_version("4.1")) {
      replace_or_add("any::terra", "rspatial/terra")
    }
  }

  

  if (is_linux) {
    switch(short_r_version,
      "4.2" = {
        replace_or_add("any::XML", "XML")
      },
      "3.6" = {
        replace_or_add(
          "any::rjson",
          "url::https://cran.r-project.org/src/contrib/Archive/rjson/rjson_0.2.20.tar.gz"
        )
      }
    )
  }
  pkgs_to_install
}
